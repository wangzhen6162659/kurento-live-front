(function(e){function n(n){for(var r,o,c=n[0],s=n[1],u=n[2],d=0,l=[];d<c.length;d++)o=c[d],a[o]&&l.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);f&&f(n);while(l.length)l.shift()();return i.push.apply(i,u||[]),t()}function t(){for(var e,n=0;n<i.length;n++){for(var t=i[n],r=!0,o=1;o<t.length;o++){var c=t[o];0!==a[c]&&(r=!1)}r&&(i.splice(n--,1),e=s(s.s=t[0]))}return e}var r={},o={app:0},a={app:0},i=[];function c(e){return s.p+"assets/js/"+({about:"about"}[e]||e)+"."+{about:"b43e72ea","chunk-24c7612c":"2aa909ea","chunk-26c2b27c":"e1e5c656","chunk-1d6d7419":"34de713b","chunk-6c584fe1":"5fe072cf","chunk-d47856c4":"2bff10ac","chunk-3f7bc161":"3acfd2a8","chunk-2180e3b2":"0328a76e","chunk-2d22a188":"4ade40a4","chunk-b179f1bc":"2df9d9fe"}[e]+".js"}function s(n){if(r[n])return r[n].exports;var t=r[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(e){var n=[],t={"chunk-1d6d7419":1,"chunk-6c584fe1":1,"chunk-d47856c4":1,"chunk-b179f1bc":1};o[e]?n.push(o[e]):0!==o[e]&&t[e]&&n.push(o[e]=new Promise(function(n,t){for(var r="assets/css/"+({about:"about"}[e]||e)+"."+{about:"31d6cfe0","chunk-24c7612c":"31d6cfe0","chunk-26c2b27c":"31d6cfe0","chunk-1d6d7419":"2e041fa7","chunk-6c584fe1":"2e041fa7","chunk-d47856c4":"65ef54e1","chunk-3f7bc161":"31d6cfe0","chunk-2180e3b2":"31d6cfe0","chunk-2d22a188":"31d6cfe0","chunk-b179f1bc":"db810bd3"}[e]+".css",a=s.p+r,i=document.getElementsByTagName("link"),c=0;c<i.length;c++){var u=i[c],d=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(d===r||d===a))return n()}var l=document.getElementsByTagName("style");for(c=0;c<l.length;c++){u=l[c],d=u.getAttribute("data-href");if(d===r||d===a)return n()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=n,f.onerror=function(n){var r=n&&n.target&&n.target.src||a,i=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");i.request=r,delete o[e],f.parentNode.removeChild(f),t(i)},f.href=a;var p=document.getElementsByTagName("head")[0];p.appendChild(f)}).then(function(){o[e]=0}));var r=a[e];if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(function(n,t){r=a[e]=[n,t]});n.push(r[2]=i);var u,d=document.createElement("script");d.charset="utf-8",d.timeout=120,s.nc&&d.setAttribute("nonce",s.nc),d.src=c(e),u=function(n){d.onerror=d.onload=null,clearTimeout(l);var t=a[e];if(0!==t){if(t){var r=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src,i=new Error("Loading chunk "+e+" failed.\n("+r+": "+o+")");i.type=r,i.request=o,t[1](i)}a[e]=void 0}};var l=setTimeout(function(){u({type:"timeout",target:d})},12e4);d.onerror=d.onload=u,document.head.appendChild(d)}return Promise.all(n)},s.m=e,s.c=r,s.d=function(e,n,t){s.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,n){if(1&n&&(e=s(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)s.d(t,r,function(n){return e[n]}.bind(null,r));return t},s.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(n,"a",n),n},s.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},s.p="/front/",s.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],d=u.push.bind(u);u.push=n,u=u.slice();for(var l=0;l<u.length;l++)n(u[l]);var f=d;i.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"034f":function(e,n,t){"use strict";var r=t("64a9"),o=t.n(r);o.a},1:function(e,n){},"365c":function(e,n,t){"use strict";var r=t("cebc"),o=t("bc3a"),a=t.n(o),i=t("323e"),c=t.n(i),s=(t("a5d8"),t("5c96")),u=t("c0d6"),d=t("41cb"),l=a.a.create({baseURL:"/api/"});l.interceptors.request.use(function(e){return c.a.start(),e.headers=Object(r["a"])({},e.headers,{token:u["a"].state.token}),e}),l.interceptors.response.use(function(e){if(c.a.done(),0===e.data.code)return e.data;if(403===e.data.code)return d["a"].push("/login");throw s["Message"].error(e.msg||"服务出\b错"),new Error(e.msg||"服务出\b错")});var f=l;t.d(n,"a",function(){return p}),t.d(n,"b",function(){return m}),t.d(n,"c",function(){return h}),t.d(n,"d",function(){return b});var p=function(e){return f.get("presentors",{params:e})},m=function(e){return f.get("videos",{params:e})},h=function(e){return f.post("user/login",e)},b=function(e){return f.post("user/register",e)}},"41cb":function(e,n,t){"use strict";t("7f7f");var r=t("2b0e"),o=t("8c4f"),a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"home"})},i=[],c={name:"home"},s=c,u=t("2877"),d=Object(u["a"])(s,a,i,!1,null,null,null),l=d.exports,f=t("c0d6");r["default"].use(o["a"]);var p=new o["a"]({base:"/front/",routes:[{path:"/",name:"home",component:l,redirect:"/livings"},{path:"/about",name:"about",component:function(){return t.e("about").then(t.bind(null,"f820"))}},{path:"/presentor",name:"presentor",component:function(e){return Promise.all([t.e("chunk-26c2b27c"),t.e("chunk-d47856c4")]).then(t.bind(null,"30ec"))}},{path:"/livings",name:"livings",component:function(e){return Promise.all([t.e("chunk-3f7bc161"),t.e("chunk-2d22a188")]).then(t.bind(null,"dff6"))}},{path:"/live/:liveId",name:"live",component:function(e){return t.e("chunk-b179f1bc").then(t.bind(null,"1502"))}},{path:"/videos",name:"videos",component:function(e){return Promise.all([t.e("chunk-3f7bc161"),t.e("chunk-2180e3b2")]).then(t.bind(null,"007b"))}},{path:"/call",name:"call",component:function(e){return Promise.all([t.e("chunk-26c2b27c"),t.e("chunk-1d6d7419")]).then(t.bind(null,"10f1"))}},{path:"/accept",name:"acceptcall",component:function(e){return Promise.all([t.e("chunk-26c2b27c"),t.e("chunk-6c584fe1")]).then(t.bind(null,"40e5"))}},{path:"/login",name:"login",component:function(e){return t.e("chunk-24c7612c").then(t.bind(null,"dd7b"))}}]});p.beforeEach(function(e,n,t){return f["a"].state.token||"login"===e.name?f["a"].state.token&&"login"===e.name?t("/"):void t():t({name:"login"})});n["a"]=p},"56d7":function(e,n,t){"use strict";t.r(n);t("cadf"),t("551c"),t("f751"),t("097d");var r=t("2b0e"),o=function(){var e=this,n=e.$createElement,r=e._self._c||n;return r("div",{staticClass:"bg-grey-lighter mx-16",attrs:{id:"app"}},[r("el-menu",{staticStyle:{margin:"20px 0",opacity:"0.8"},attrs:{mode:"horizontal",router:""}},[r("el-menu-item",{attrs:{index:"/"}},[r("h1",[r("img",{staticClass:"w-64",attrs:{src:t("cf05"),alt:""}})])]),r("el-menu-item",{attrs:{index:"/presentor"}},[e._v("我要做直播")]),r("el-menu-item",{attrs:{index:"/livings"}},[e._v("我要看直播")]),e.userInfo.nickname?r("el-submenu",{staticStyle:{float:"right"},attrs:{index:"2"}},[r("template",{staticClass:"user flex items-center",slot:"title"},[r("img",{staticClass:"user-avatar inline-block h-12 w-12 rounded-full border",attrs:{src:e.userInfo.avatar||"https://via.placeholder.com/50",alt:""}}),r("span",{staticClass:"mx-2"},[e._v(e._s(e.userInfo.nickname))])]),r("el-menu-item",{attrs:{index:"2-1"}},[r("el-button",{attrs:{type:"text"},on:{click:function(n){return n.stopPropagation(),e.logout(n)}}},[e._v("注销登录")])],1)],2):e._e()],1),r("header",{staticClass:"flex p-1 items-center justify-between"}),r("router-view")],1)},a=[],i=t("e814"),c=t.n(i),s=t("6c23"),u=(t("8c8a"),{computed:{userInfo:function(){return this.$store.state.userInfo||{}},token:function(){return this.$store.state.token||""}},beforeDestroy:function(){Object(s["c"])()},methods:{logout:function(){this.$store.commit("clearAuthState"),location.reload()}},mounted:function(){window.setRtcUtils(),localStorage.setItem("token",c()(100*Math.random()))}}),d=u,l=(t("034f"),t("2877")),f=Object(l["a"])(d,o,a,!1,null,null,null),p=f.exports,m=t("41cb"),h=t("c0d6"),b=(t("d093"),t("5c96")),g=t.n(b);t("0fae"),t("1157");r["default"].config.productionTip=!1,r["default"].use(g.a),new r["default"]({router:m["a"],store:h["a"],render:function(e){return e(p)}}).$mount("#app")},"64a9":function(e,n,t){},"6c23":function(e,n,t){"use strict";t.d(n,"c",function(){return s}),t.d(n,"a",function(){return u}),t.d(n,"b",function(){return d});var r=t("8055"),o=t.n(r),a=t("5c96"),i=(t("c0d6"),t("41cb"),null),c=function(e){a["Message"].error(e.message)},s=function(){},u=function(e){if(i)return i},d=function(e){var n=o()(url,{reconnection:!1,path:"/call",transports:["websocket","xhr-polling","jsonp-polling"]});return n.on("connect_error",c),n.on("error",c),n}},"8c8a":function(e,n,t){"use strict";(function(e){var n=t("59ad"),r=t.n(n),o=t("e814"),a=t.n(o),i=t("f499"),c=t.n(i),s=(t("a825"),t("d519")),u=t.n(s),d=(t("6c23"),t("faa1").EventEmitter);function l(e){if("PermissionDeniedError"==e){if(m="PermissionDeniedError",p)return p("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(m="desktop"),e.sourceId&&p&&p(f=e.sourceId)}window.setRtcUtils=function(){var n={};n.notice=new d,n.hostname=this.window.location.hostname,n.ws=new WebSocket("wss://"+n.hostname+"/websocket/socketServer"),n.video,n.webRtcPeer=null,n.iceservers={iceServers:[{urls:"turn:106.54.254.212:3478",username:"kurento",credential:"kurento"}]},n.constraints={audio:!0,video:{width:720,height:480,framerate:1024}},n.ws.onmessage=function(e){var t=JSON.parse(e.data);switch(console.info("Received message: "+e.data),t.id){case"presenterResponse":n.presenterResponse(t),n.notice.emit("living",1);break;case"viewerResponse":n.viewerResponse(t),n.notice.emit("living",1);break;case"iceCandidate":n.webRtcPeer.addIceCandidate(t.candidate,function(e){if(e)return console.error("Error adding candidate: "+e)});break;case"stopCommunication":n.dispose();break;case"interactionResponse":n.notice.emit("interactionAdd",t);break;default:console.error("Unrecognized message",t)}},n.onload=function(){console=new Console,n.video=document.getElementById("video"),n.disableStopButton()},n.onbeforeunload=function(){n.ws.close()},n.presenterResponse=function(e){var n=this;if("accepted"!=e.response){var t=e.message?e.message:"Unknow error";console.info("Call not accepted for the following reason: "+t),n.dispose()}else n.webRtcPeer.processAnswer(e.sdpAnswer,function(e){if(e)return console.error(e)})},n.viewerResponse=function(e){var t=this;if("accepted"!=e.response){var r=e.message?e.message:"Unknow error";console.info("Call not accepted for the following reason: "+r),n.dispose()}else t.webRtcPeer.processAnswer(e.sdpAnswer,function(e){if(e)return console.error(e)})},n.presenter=function(){if(n.isHaveRoomId()&&!n.webRtcPeer){n.showSpinner(n.video);var e=this,t={localVideo:n.video,onicecandidate:n.onIceCandidate,configuration:n.iceservers,mediaConstraints:n.constraints};n.webRtcPeer=new u.a.WebRtcPeer.WebRtcPeerSendonly(t,function(n){if(n)return console.error(n);e.webRtcPeer.generateOffer(e.onOfferPresenter)}),n.enableStopButton()}},n.onOfferPresenter=function(e,t){if(e)return console.error("Error generating the offer");console.info("Invoking SDP offer callback "+location.host);var r={id:"presenter",sdpOffer:t};n.sendMessage(r)},n.viewer=function(){if(n.isHaveRoomId()&&!n.webRtcPeer){var e={remoteVideo:n.video,onicecandidate:n.onIceCandidate,configuration:n.iceservers,mediaConstraints:n.constraints};n.webRtcPeer=new u.a.WebRtcPeer.WebRtcPeerRecvonly(e,function(e){if(e)return console.error(e);this.generateOffer(n.onOfferViewer)}),n.enableStopButton()}},n.onOfferViewer=function(e,t){if(e)return console.error("Error generating the offer");console.info("Invoking SDP offer callback "+location.host);var r={id:"viewer",sdpOffer:t};n.sendMessage(r)},n.onIceCandidate=function(e){console.log("Local candidate"+c()(e));var t={id:"onIceCandidate",candidate:e};n.sendMessage(t)},n.stop=function(){var e={id:"stop"};n.sendMessage(e),n.dispose()},n.dispose=function(){n.webRtcPeer&&(n.webRtcPeer.dispose(),n.webRtcPeer=null),n.hideSpinner(n.video),n.notice.emit("stop"),n.disableStopButton()},n.disableStopButton=function(){n.enableButton("#presenter","presenter()"),n.enableButton("#viewer","viewer()"),n.disableButton("#stop")},n.enableStopButton=function(){n.disableButton("#presenter"),n.disableButton("#viewer"),n.enableButton("#stop","stop()")},n.disableButton=function(n){e(n).attr("disabled",!0),e(n).removeAttr("onclick")},n.enableButton=function(n,t){e(n).attr("disabled",!1),e(n).attr("onclick",t)},n.isHaveRoomId=function(){return!!n.getRoomId()||(alert("请选择直播间！"),!1)},n.getRoomId=function(){return a()(localStorage.getItem("liveId"))},n.sendMessage=function(e){var t=n.getRoomId();e.liveId=t,e.token=localStorage.getItem("token");var r=c()(e);console.log("Sending message: "+r),n.ws.send(r)},n.showSpinner=function(){for(var e=0;e<arguments.length;e++)arguments[e].poster="./img/transparent-1px.png",arguments[e].style.background='center transparent url("./img/spinner.gif") no-repeat'},n.hideSpinner=function(){for(var e=0;e<arguments.length;e++)arguments[e].src="",arguments[e].poster="./img/webrtc.png",arguments[e].style.background=""},n.init=function(){n.notice=new d},n.interaction=function(e){var t={id:"interaction",msg:e};n.sendMessage(t)},n.wordMove=function(e){var t=document.getElementsByClassName("container-video")[0],o=document.createElement("span");o.innerHTML=e;var i=n.random(1,3);o.style.position="absolute",o.className="tm",o.style.left=n.video.offsetWidth+n.video.width+"px",o.style.top=n.random(20,150)+"px",t.appendChild(o);var c=setInterval(function(){o.style.left=r()(o.style.left)-i+"px",a()(o.style.left)<0-o.offsetWidth&&(clearInterval(c),t.removeChild(o))},10)},n.random=function(e,n){return Math.floor(Math.random()*(n-e)+e)},window.RtcUtils=n},window.addEventListener("message",function(e){e.origin==window.location.origin&&l(e.data)});var f,p,m="screen";function h(e){if(!e)throw'"callback" parameter is mandatory.';if(f)return e(f);p=e,window.postMessage("get-sourceId","*")}var b="undefined"!==typeof window.InstallTrigger,g=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;window.chrome;window.getScreenConstraints=function(e){var n={mozMediaSource:"window",mediaSource:"window"};if(b)return e(null,n);var t={mandatory:{chromeMediaSource:m,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};"desktop"!=m||f?("desktop"==m&&(t.mandatory.chromeMediaSourceId=f),e(null,t)):h(function(){t.mandatory.chromeMediaSourceId=f,e("PermissionDeniedError"==f?f:null,t)})}}).call(this,t("1157"))},a825:function(e,n,t){"use strict";t.d(n,"a",function(){return r});var r=[{urls:"turn:123.207.49.169:3478",username:"qwertyyb",credential:"webrtc"}]},c0d6:function(e,n,t){"use strict";var r=t("f499"),o=t.n(r),a=t("cebc"),i=t("2b0e"),c=t("2f62"),s=t("365c");i["default"].use(c["a"]),n["a"]=new c["a"].Store({state:{token:localStorage.getItem("token")||"",userInfo:JSON.parse(localStorage.getItem("userInfo")||"{}")},mutations:{updateToken:function(e,n){e.token=n},updateUserInfo:function(e,n){e.userInfo=Object(a["a"])({},n)},clearAuthState:function(e){e.token="",e.userInfo={},localStorage.setItem("token",""),localStorage.setItem("userInfo","{}")}},actions:{login:function(e,n){var t=e.commit,r=n.nickname,a=n.password;return Object(s["c"])({nickname:r,password:a}).then(function(e){var n=e.data;return t("updateToken",n.token),t("updateUserInfo",n.user),localStorage.setItem("token",n.token),localStorage.setItem("userInfo",o()(n.user)),n})}}})},cf05:function(e,n,t){e.exports=t.p+"assets/img/logo.0a9cb5db.png"}});
//# sourceMappingURL=app.2ba1e06d.js.map